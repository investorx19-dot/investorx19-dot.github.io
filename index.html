<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mark6 • Gerador de Jogos - Mega-Sena</title>
  <style>
    :root{
      --bg1:#070b14;
      --bg2:#0b1633;
      --card:#0f1f3a;
      --card2:#0c1930;
      --line:rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.70);
      --blue:#2f6bff;
      --blue2:#1b4fd6;
      --good:#30d158;
      --bad:#ff453a;
      --warn:#ffd60a;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 50% -100px, rgba(47,107,255,.25), transparent 55%),
                  radial-gradient(900px 500px at 80% 10%, rgba(255,214,10,.12), transparent 60%),
                  linear-gradient(180deg, var(--bg2), var(--bg1));
      min-height:100vh;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 34px 18px 60px;
    }

    .topo{
      text-align:center;
      margin-bottom: 18px;
    }

    .logo{
      width: 120px;
      height: auto;
      display:block;
      margin: 0 auto 8px;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,.55));
    }

    h1{
      margin: 0 0 6px;
      font-size: 38px;
      letter-spacing: .2px;
    }

    .sub{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .panel{
      margin-top: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .card{
      background: linear-gradient(180deg, rgba(15,31,58,.90), rgba(12,25,48,.92));
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
    }

    .card h2{
      margin: 0 0 10px;
      font-size: 18px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 6px;
    }

    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }
    input:focus{
      border-color: rgba(47,107,255,.55);
      box-shadow: 0 0 0 4px rgba(47,107,255,.12);
    }

    .btns{
      display:flex;
      gap:10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    button{
      border:none;
      cursor:pointer;
      padding: 11px 14px;
      border-radius: 12px;
      font-weight: 700;
      color: #fff;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.10);
    }

    .primary{
      background: linear-gradient(180deg, var(--blue), var(--blue2));
      border-color: rgba(47,107,255,.55);
    }
    .ghost{
      background: rgba(255,255,255,.06);
    }

    .status{
      margin-top: 12px;
      font-size: 13px;
      color: var(--muted);
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap: wrap;
    }

    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      color: var(--text);
      font-size: 12px;
    }

    .pill.good{ border-color: rgba(48,209,88,.35); }
    .pill.bad{ border-color: rgba(255,69,58,.35); }
    .pill.warn{ border-color: rgba(255,214,10,.35); }

    .actions{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      margin: 8px 0 14px;
      flex-wrap: wrap;
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 14px 0;
    }

    .cartao h2{
      margin: 0 0 10px;
      font-size: 20px;
    }

    .linha{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.08);
      margin: 10px 0;
      overflow-x:auto;
      white-space: nowrap;
    }

    .linha strong{
      min-width: 150px;
      color: var(--text);
    }

    .num{
      display:inline-flex;
      width: 34px;
      height: 34px;
      align-items:center;
      justify-content:center;
      border-radius: 10px;
      margin-right: 6px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      font-weight: 800;
    }

    .sel{
      background: rgba(255,214,10,.18);
      border-color: rgba(255,214,10,.45);
      color: #fff;
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
      line-height: 1.45;
    }

    @media (max-width: 820px){
      .row{ grid-template-columns: 1fr; }
      h1{ font-size: 30px; }
      .logo{ width: 105px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topo">
      <!-- LOGO: arquivo no repo precisa ser exatamente logo-marck6.jpg -->
      <img src="./logo-marck6.jpg" alt="Mark6" class="logo" />
      <h1>Gerador de Jogos - Mega-Sena</h1>
      <p class="sub">Cadastro e liberação pelo administrador • Mark6</p>
    </div>

    <div class="panel">
      <div id="loginArea" class="grid">
        <div class="card">
          <h2>Cadastro / Login</h2>

          <div class="row">
            <div>
              <label for="nome">Nome</label>
              <input id="nome" placeholder="Seu nome completo" autocomplete="name" />
            </div>

            <div>
              <label for="telefone">Telefone (WhatsApp)</label>
              <input id="telefone" placeholder="(21) 99999-9999" autocomplete="tel" />
            </div>

            <div>
              <label for="email">E-mail</label>
              <input id="email" placeholder="seuemail@gmail.com" autocomplete="email" />
            </div>

            <div>
              <label for="senha">Senha</label>
              <input id="senha" type="password" placeholder="Crie sua senha" autocomplete="current-password" />
            </div>
          </div>

          <div class="btns">
            <button class="primary" id="btnCadastrar">Cadastrar</button>
            <button class="ghost" id="btnEntrar">Entrar</button>
          </div>

          <div class="status">
            <span class="pill" id="statusPill">Status: —</span>
            <span class="pill" id="userPill" style="display:none;"></span>
          </div>

          <div class="hint">
            • O acesso ao gerador só é liberado após aprovação do administrador.<br>
            • Seu cadastro é salvo no Firestore (não depende do seu navegador).
          </div>
        </div>
      </div>

      <div id="appArea" style="display:none;">
        <div class="actions">
          <button class="primary" id="btnGerar">GERAR JOGO</button>
          <button class="ghost" id="btnSair">Sair</button>
        </div>

        <div class="status">
          <span class="pill" id="pillUsuario"></span>
          <span class="pill" id="pillAcesso"></span>
        </div>

        <div class="divider"></div>

        <div class="cartao card">
          <h2>Cartão Virtual</h2>
          <div id="cartao"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import {
      getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // Firebase config (o seu)
    const firebaseConfig = {
      apiKey: "AIzaSyA9ccyTSDoWiqrwnq9K7nAEjeOHZahKIu0",
      authDomain: "painel-megasena.firebaseapp.com",
      projectId: "painel-megasena",
      storageBucket: "painel-megasena.firebasestorage.app",
      messagingSenderId: "924943702876",
      appId: "1:924943702876:web:77929086c5addb13b37f99"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ====== UI refs
    const loginArea = document.getElementById("loginArea");
    const appArea   = document.getElementById("appArea");

    const nomeEl = document.getElementById("nome");
    const telEl  = document.getElementById("telefone");
    const emailEl= document.getElementById("email");
    const senhaEl= document.getElementById("senha");

    const btnCadastrar = document.getElementById("btnCadastrar");
    const btnEntrar    = document.getElementById("btnEntrar");
    const btnGerar     = document.getElementById("btnGerar");
    const btnSair      = document.getElementById("btnSair");

    const statusPill = document.getElementById("statusPill");
    const userPill   = document.getElementById("userPill");

    const pillUsuario = document.getElementById("pillUsuario");
    const pillAcesso  = document.getElementById("pillAcesso");

    const cartao = document.getElementById("cartao");

    // ====== Helpers
    const emailKey = (e) => (e || "").trim().toLowerCase();

    function setStatus(texto, tipo=""){
      statusPill.textContent = "Status: " + texto;
      statusPill.className = "pill " + (tipo || "");
    }

    function validarTelefone(t){
      const s = (t || "").trim();
      // validação simples: precisa ter pelo menos 10 dígitos
      const digits = s.replace(/\D/g, "");
      return digits.length >= 10;
    }

    function showApp(user){
      loginArea.style.display = "none";
      appArea.style.display = "block";

      pillUsuario.textContent = `Usuário: ${user.email}`;
      pillAcesso.textContent  = user.accessGranted ? "Acesso: Liberado" : "Acesso: Bloqueado";
      pillAcesso.className = "pill " + (user.accessGranted ? "good" : "bad");

      renderCartao([]); // começa vazio
    }

    function showLogin(){
      loginArea.style.display = "grid";
      appArea.style.display = "none";
      userPill.style.display = "none";
      setStatus("—");
    }

    // ====== Cartão Virtual (exemplo)
    const LINE_RANGES = {
      1: Array.from({length:10}, (_,i)=>i+1),
      2: Array.from({length:10}, (_,i)=>i+11),
      3: Array.from({length:10}, (_,i)=>i+21),
      4: Array.from({length:10}, (_,i)=>i+31),
      5: Array.from({length:10}, (_,i)=>i+41),
      6: Array.from({length:10}, (_,i)=>i+51),
    };

    function renderCartao(jogo){
      cartao.innerHTML = "";
      for (let l=1; l<=6; l++){
        const div = document.createElement("div");
        div.className = "linha";
        div.innerHTML = `<strong>Linha ${l} (${LINE_RANGES[l][0]}-${LINE_RANGES[l][9]}):</strong>`;

        LINE_RANGES[l].forEach(n=>{
          const span = document.createElement("span");
          span.className = "num" + (jogo.includes(n) ? " sel" : "");
          span.textContent = String(n).padStart(2,"0");
          div.appendChild(span);
        });

        cartao.appendChild(div);
      }
    }

    // ====== Firestore: users/{emailLower}
    async function cadastrar(){
      const nome = (nomeEl.value || "").trim();
      const telefone = (telEl.value || "").trim();
      const email = emailKey(emailEl.value);
      const senha = (senhaEl.value || "").trim();

      if (!nome) return alert("Informe seu nome.");
      if (!email.includes("@")) return alert("Informe um e-mail válido.");
      if (!validarTelefone(telefone)) return alert("Informe um telefone válido (com DDD).");
      if (senha.length < 4) return alert("A senha deve ter pelo menos 4 caracteres.");

      const ref = doc(db, "users", email);
      const snap = await getDoc(ref);

      // ✅ sem duplicação: se já existe, não cadastra de novo
      if (snap.exists()){
        setStatus("E-mail já cadastrado. Use Entrar.", "warn");
        return;
      }

      await setDoc(ref, {
        nome,
        telefone,
        email,
        senha,                // ⚠️ simples (não recomendado em produção)
        accessGranted: false,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      });

      setStatus("Cadastro criado. Aguarde liberação do admin.", "warn");
      userPill.style.display = "inline-block";
      userPill.textContent = `Usuário: ${email}`;
      userPill.className = "pill";
    }

    async function entrar(){
      const email = emailKey(emailEl.value);
      const senha = (senhaEl.value || "").trim();
      if (!email.includes("@")) return alert("Informe um e-mail válido.");
      if (!senha) return alert("Informe sua senha.");

      const ref = doc(db, "users", email);
      const snap = await getDoc(ref);

      if (!snap.exists()){
        setStatus("Usuário não encontrado. Cadastre-se.", "bad");
        return;
      }

      const u = snap.data();

      if (u.senha !== senha){
        setStatus("Credenciais inválidas.", "bad");
        return;
      }

      userPill.style.display = "inline-block";
      userPill.textContent = `Usuário: ${email}`;
      userPill.className = "pill";

      if (!u.accessGranted){
        setStatus("Aguardando ação do administrador.", "warn");
        return;
      }

      // atualiza último login
      await updateDoc(ref, { updatedAt: serverTimestamp() });

      setStatus("Liberado. Bem-vindo!", "good");
      showApp(u);
      sessionStorage.setItem("user_email", email);
    }

    async function gerarJogo(){
      // Aqui você pode integrar sua lógica real (admin salva config/global e user lê).
      // Por enquanto um jogo simples aleatório só para mostrar no cartão:
      const nums = new Set();
      while (nums.size < 6){
        nums.add(1 + Math.floor(Math.random()*60));
      }
      const jogo = Array.from(nums).sort((a,b)=>a-b);
      renderCartao(jogo);
      alert("Jogo gerado: " + jogo.map(n=>String(n).padStart(2,"0")).join(" - "));
    }

    // ====== eventos
    btnCadastrar.addEventListener("click", cadastrar);
    btnEntrar.addEventListener("click", entrar);
    btnGerar.addEventListener("click", gerarJogo);
    btnSair.addEventListener("click", ()=>{
      sessionStorage.removeItem("user_email");
      showLogin();
    });

    // ====== auto-login (se já entrou na sessão)
    (async ()=>{
      const saved = sessionStorage.getItem("user_email");
      if (!saved) {
        setStatus("—");
        return;
      }
      const ref = doc(db, "users", saved);
      const snap = await getDoc(ref);
      if (snap.exists()){
        const u = snap.data();
        if (u.accessGranted){
          setStatus("Liberado. Bem-vindo!", "good");
          showApp(u);
        } else {
          setStatus("Aguardando ação do administrador.", "warn");
        }
      }
    })();
  </script>
</body>
</html>
